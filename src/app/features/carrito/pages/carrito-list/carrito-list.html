<section class="cart-page">
  <header class="cart-header">
    <h1>Tu carrito</h1>
    <p>Revisa los productos que has agregado antes de finalizar la compra.</p>
  </header>

  <ng-container *ngIf="(items$ | async) as items; else emptyCart">
    <div class="cart-layout" *ngIf="items.length; else emptyCart">
      <div class="cart-items">
        <article class="cart-item" *ngFor="let item of items; trackBy: trackByItem">
          <div class="cart-item-media">
            <img [src]="item.product.image" [alt]="item.product.name" loading="lazy" />
          </div>

          <div class="cart-item-info">
            <h2>{{ item.product.name }}</h2>
            <p class="cart-item-meta" *ngIf="item.product.category || item.product.subCategory">
              {{ item.product.category }}<span *ngIf="item.product.subCategory"> • {{ item.product.subCategory }}</span>
            </p>
            <p class="cart-item-meta" *ngIf="item.product.size">Talla: {{ item.product.size }}</p>
            <p class="cart-item-meta" *ngIf="item.product.color">Color: {{ item.product.color }}</p>

            <p class="cart-item-price">
              {{ item.product.price | currency:'USD':'symbol':'1.0-0' }}
            </p>

            <div class="cart-item-actions">
              <div class="quantity-control">
                <button type="button" (click)="decrement(item.product.id)" aria-label="Disminuir cantidad">
                  −
                </button>
                <input
                  type="number"
                  min="1"
                  [value]="item.quantity"
                  (change)="updateQuantity(item.product.id, $event.target.value)" />
                <button type="button" (click)="increment(item.product.id)" aria-label="Aumentar cantidad">
                  +
                </button>
              </div>
              <button type="button" class="remove" (click)="removeItem(item.product.id)">
                Eliminar
              </button>
            </div>
          </div>

          <div class="cart-item-total">
            <span>Total</span>
            <strong>
              {{ (item.product.price * item.quantity) | currency:'USD':'symbol':'1.0-0' }}
            </strong>
          </div>
        </article>
      </div>

      <aside class="cart-summary">
        <h2>Resumen</h2>
        <div class="summary-row">
          <span>Productos</span>
          <span>{{ (totalQuantity$ | async) }}</span>
        </div>
        <div class="summary-row total">
          <span>Total</span>
          <strong>{{ (total$ | async) | currency:'USD':'symbol':'1.0-0' }}</strong>
        </div>
        <p class="summary-note">
          El envío y los impuestos se calculan durante el proceso de checkout.
        </p>
        <a routerLink="/checkout" class="summary-checkout">Proceder al checkout</a>
        <button type="button" class="summary-clear" (click)="clearCart()">Vaciar carrito</button>
        <a routerLink="/catalogo" class="summary-continue">Seguir comprando</a>
      </aside>
    </div>
  </ng-container>

  <ng-template #emptyCart>
    <div class="empty-cart">
      <h2>Tu carrito está vacío</h2>
      <p>Explora nuestro catálogo y agrega tus prendas favoritas.</p>
      <a routerLink="/catalogo" class="empty-link">Ir al catálogo</a>
    </div>
  </ng-template>
</section>