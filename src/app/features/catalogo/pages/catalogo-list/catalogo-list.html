<div class="catalog-wrapper" [class.filters-open]="isFiltersOpen">
  <!-- Barra móvil -->
  <div class="mobile-filters-bar">
    <button
      #filtersButtonRef
      type="button"
      class="filters-toggle"
      (click)="openFilters()"
      aria-controls="catalog-filters"
      [attr.aria-expanded]="isFiltersOpen">
      Filtros
    </button>
  </div>

  <!-- Backdrop móvil -->
  <div class="filters-backdrop" *ngIf="isFiltersOpen" (click)="closeFilters()"></div>

  <!-- Sidebar de filtros -->
  <aside
    id="catalog-filters"
    class="filters-panel"
    [class.open]="isFiltersOpen"
    aria-label="Filtros">
    <form [formGroup]="filtersForm" class="filters-form">
      <!-- Categoría -->
      <div class="filters-section">
        <h3>Categoría</h3>
        <div class="option" *ngFor="let category of categoryOptions">
          <label>
            <input
              type="checkbox"
              [checked]="filtersForm.controls.categories.value.includes(category)"
              (change)="onCheckboxChange('categories', category, $event.target.checked)" />
            <span>{{ category }}</span>
          </label>
        </div>
      </div>

      <!-- Talla -->
      <div class="filters-section">
        <h3>Talla</h3>
        <div class="option" *ngFor="let size of sizeOptions">
          <label>
            <input
              type="checkbox"
              [checked]="filtersForm.controls.sizes.value.includes(size)"
              (change)="onCheckboxChange('sizes', size, $event.target.checked)" />
            <span>{{ size }}</span>
          </label>
        </div>
      </div>

      <!-- Color -->
      <div class="filters-section">
        <h3>Color</h3>
        <div class="option" *ngFor="let color of colorOptions">
          <label>
            <input
              type="checkbox"
              [checked]="filtersForm.controls.colors.value.includes(color)"
              (change)="onCheckboxChange('colors', color, $event.target.checked)" />
            <span>{{ color }}</span>
          </label>
        </div>
      </div>

      <!-- Precio -->
      <div class="filters-section">
        <h3>Precio</h3>
        <div class="price-inputs">
          <label>
            <span>Min</span>
            <input type="number" formControlName="priceMin" min="0" (change)="onPriceChange()" />
          </label>
          <label>
            <span>Max</span>
            <input type="number" formControlName="priceMax" min="0" (change)="onPriceChange()" />
          </label>
        </div>
      </div>

      <!-- Acciones -->
      <div class="filters-actions">
        <button type="button" (click)="applyFilters()">Aplicar</button>
        <button type="button" (click)="clearFilters()">Limpiar</button>
      </div>
    </form>
  </aside>

  <!-- Contenido principal -->
  <main class="catalog-content">
    <!-- chips de filtros aplicados -->
    <section class="applied-filters" *ngIf="appliedChips?.length">
      <button
        class="chip"
        *ngFor="let chip of appliedChips; trackBy: trackByChip"
        type="button"
        (click)="removeFilterChip(chip)">
        {{ chip.label }} ✕
      </button>
      <button type="button" class="clear-all" (click)="clearFilters()">Limpiar filtros</button>
    </section>

    <!-- barra superior (orden) -->
    <section class="toolbar">
      <label>
        Ordenar por:
        <select [formControl]="filtersForm.controls['sort']" (change)="applyFilters()">
          <option value="relevance">Relevancia</option>
          <option value="priceAsc">Precio ↑</option>
          <option value="priceDesc">Precio ↓</option>
          <option value="newest">Novedades</option>
        </select>
      </label>
    </section>

    <!-- grilla de productos -->
    <section class="products" *ngIf="filteredProducts?.length; else emptyState">
      <article class="product-card" *ngFor="let product of pagedProducts; trackBy: trackById">
        <div class="card-media">
          <img
            [ngSrc]="product.image"
            [alt]="product.name"
            width="300"
            height="400"
            loading="lazy" />
        </div>
        <div class="card-body">
          <h3>{{ product.name }}</h3>
          <p class="price">{{ product.price | currency:'USD':'symbol':'1.0-0' }}</p>
          <p class="meta">
            <span>{{ product.category }}</span>
            <span>Talla: {{ product.size }}</span>
            <span>Color: {{ product.color }}</span>
          </p>
        </div>
      </article>
    </section>

    <ng-template #emptyState>
      <div class="empty-state">
        <p>No se encontraron productos con los filtros seleccionados.</p>
      </div>
    </ng-template>

    <!-- paginación -->
    <nav class="pagination" aria-label="Paginación de productos" *ngIf="filteredProducts?.length">
      <button type="button" (click)="goToPreviousPage()" [disabled]="page === 1">Anterior</button>
      <span>Página {{ page }} de {{ totalPages }}</span>
      <button type="button" (click)="goToNextPage()" [disabled]="page === totalPages">Siguiente</button>
    </nav>
  </main>
</div>
